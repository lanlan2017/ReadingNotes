---
title: 13.3 实现DAO持久层
categories: 
  - Spring+Mybatis企业应用实战(第2版)
  - 第13章 实战项目人事管理系统
  - 13.3 实现DAO持久层
date: 2019-06-20 11:24:44
updated: 2019-11-02 01:38:59
abbrlink: 6c01fe0c
---
- [13.3 实现DAO持久层](/ReadingNotes/6c01fe0c/#13-3-实现DAO持久层)
    - [13.3.1 公共常量类](/ReadingNotes/6c01fe0c/#13-3-1-公共常量类)
        - [HrmConstants.java](/ReadingNotes/6c01fe0c/#HrmConstants-java)
    - [13.3.2 定义DAO接口](/ReadingNotes/6c01fe0c/#13-3-2-定义DAO接口)
        - [UserDao接口](/ReadingNotes/6c01fe0c/#UserDao接口)
        - [UserDynaSqlProvider.java](/ReadingNotes/6c01fe0c/#UserDynaSqlProvider-java)
        - [DeptDao接口](/ReadingNotes/6c01fe0c/#DeptDao接口)
        - [JobDao接口](/ReadingNotes/6c01fe0c/#JobDao接口)
        - [JobDynaSqlProvider.java](/ReadingNotes/6c01fe0c/#JobDynaSqlProvider-java)
        - [EmployeeDao.java](/ReadingNotes/6c01fe0c/#EmployeeDao-java)
        - [EmployeeDynaSqlProvider.java](/ReadingNotes/6c01fe0c/#EmployeeDynaSqlProvider-java)
        - [NoticeDao接口](/ReadingNotes/6c01fe0c/#NoticeDao接口)
        - [NoticeDynaSqlProvider.java](/ReadingNotes/6c01fe0c/#NoticeDynaSqlProvider-java)
        - [DocumentDao接口](/ReadingNotes/6c01fe0c/#DocumentDao接口)
        - [DocumentDynaSqlProvider.java](/ReadingNotes/6c01fe0c/#DocumentDynaSqlProvider-java)
    - [13.3.3 部署DAO层](/ReadingNotes/6c01fe0c/#13-3-3-部署DAO层)
        - [db.properties](/ReadingNotes/6c01fe0c/#db-properties)
        - [applicationContext.xml](/ReadingNotes/6c01fe0c/#applicationContext-xml)

<!--more-->
<script src="https://cdn.bootcss.com/jquery/3.4.0/jquery.slim.min.js"></script>
<script>$(document).ready(function () {$(".post-body > ul:nth-child(1)").hide();});</script>

<!--end-->
# 13.3 实现DAO持久层 #
**`MyBatis`建议定义接口完成`SQL`语句的映射,该接口可以直接作为`DAO`组件使用**。使用`DAO`模式,既能体现业务逻辑组件封装`DAO`组件的**门面模式**,也可**分离业务逻辑组件和`DAO`组件的功能**:**业务逻辑组件负责业务逻辑的变化,而`DAO`组件负责持久化技术的变化**,这正是**桥接模式**的应用。

引入`DAO`模式后,**每个`DAO`组件包含了数据库的访问逻辑:每个`DAO`组件可对一个数据库表完成基本的`CRUD`等操作**.
## 13.3.1 公共常量类 ##
### HrmConstants.java ###
在`HrmConstants`类中定义了本系统中使用的常量。
## 13.3.2 定义DAO接口 ##
### UserDao接口 ###
下面是`UserDao`接口的源代码。
在`Userdao`接口中使用了动态`SQL`提供类:`UserDynasqlProvider`.
### UserDynaSqlProvider.java ###
通过上面的`DAO`接口完成数据库的操作,这种简单的实现较之传统的`JDBC`持久化访问方便。
### DeptDao接口 ###
下面是`DeptDao`接口的源代码:
### JobDao接口 ###
下面是`JobDao`接口的源代码。
在`JobDao`接口中使用了动态`SQL`提供类`JobDynaSqlProvider`。
### JobDynaSqlProvider.java ###
### EmployeeDao.java ###
下面是`EmployeeDao`接口的源代码。
在`EmployeeDao`接口中使用了动态SQL提供类`EmployeeDynaSqlProvider`。
### EmployeeDynaSqlProvider.java ###
下面是`NoticeDao`接口的源代码。
### NoticeDao接口 ###

在`Noticedao`接口中使用了动态`SQL`提供类`NoticeDynaSqlProvider`：
### NoticeDynaSqlProvider.java ###
下面是`DocumentDao`接口的源代码。
### DocumentDao接口 ###
在`DocumentDao`接口中使用了动态SL提供类`DocumentDynaSqlProvider`
### DocumentDynaSqlProvider.java ###
## 13.3.3 部署DAO层 ##
通过前面的介绍不难发现,`MyBatis`的持久化`DAO`接口只需要通过`SqlSession`的`getMapper`方法获得对应的接口实例,即可以调用接口的方法完成数据库操作。而**在`Spring`和`MyBatis`整合的应用中,由`Spring`容器负责生成并管理`DAO`组件**
**`MyBatis`社区自己开发了一个`Mybatis-Spring`中间件用来满足`MyBatis`用户整合`Spring`的需求**。通过`SqlSessionFactoryBean`类,可以将`SqlSessionFactory`纳入`IoC`容器内。
**在使用`Spring`管理`DAO`组件之前,必须要为其提供对应的数据源**,本应用使用`C3PO`数据源.
### db.properties ###
```
dataSource.driverClass=com.mysql.jdbc.Driver
dataSource.jdbcUrl=jdbc:mysql://127.0.0.1:3306/hrm_db
dataSource.user=root
dataSource.password=root
dataSource.maxPoolSize=20
dataSource.maxIdleTime = 1000
dataSource.minPoolSize=6
dataSource.initialPoolSize=5
```
配置了所需的数据源之后,程序就可以在此数据源基础上配置`SqlSessionFactory`对象。配置`SqlSessionFactory`的代码如下:
### applicationContext.xml ###
```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans
    xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:mybatis="http://mybatis.org/schema/mybatis-spring"
    xmlns:p="http://www.springframework.org/schema/p"
    xmlns:tx="http://www.springframework.org/schema/tx"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-4.3.xsd
		http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx-4.3.xsd
        http://mybatis.org/schema/mybatis-spring
        http://mybatis.org/schema/mybatis-spring.xsd">
    <!-- mybatis:scan会扫描org.fkit.dao包里的所有接口当作Spring的bean配置，之后可以进行依赖注入 -->
    <mybatis:scan base-package="org.fkit.hrm.dao"/>
    <!-- 扫描org.fkit包下面的java文件，有Spring的相关注解的类，则把这些类注册为Spring的bean -->
    <context:component-scan base-package="org.fkit.hrm"/>
    <!-- 使用PropertyOverrideConfigurer后处理器加载数据源参数 -->
    <context:property-override
        location="classpath:db.properties"/>
    <!-- 配置c3p0数据源 -->
    <bean
        id="dataSource"
        class="com.mchange.v2.c3p0.ComboPooledDataSource"/>
    <!-- 配置SqlSessionFactory，org.mybatis.spring.SqlSessionFactoryBean是Mybatis社区开发用于整合Spring的bean -->
    <bean
        id="sqlSessionFactory"
        class="org.mybatis.spring.SqlSessionFactoryBean"
        p:dataSource-ref="dataSource"/>
    <!-- JDBC事务管理器 -->
    <bean
        id="transactionManager"
        class="org.springframework.jdbc.datasource.DataSourceTransactionManager"
        p:dataSource-ref="dataSource"/>
    <!-- 启用支持annotation注解方式事务管理 -->
    <tx:annotation-driven
        transaction-manager="transactionManager"/>
</beans>
```
`<mybatis:scan base-package="org.fkit.hrm.dao"/>`标签，会扫描`org.fkit.hrm.dao`包下面的所有接口作为`Spring`的`Bean`配置,之后可以**进行依赖注入**。

