---
title: 10.2.7 Java 7的自动关闭资源的try语句
categories: 
  - 疯狂Java讲义 (第4版)
  - 第10章 异常处理
  - 10.2 异常处理机制
date: 2019-07-13 17:00:13
updated: 2019-11-02 01:39:00
abbrlink: 655287c5
---
- [10.2.7 Java 7的自动关闭资源的try语句](/ReadingNotes/655287c5/#10-2-7-Java-7的自动关闭资源的try语句)
    - [什么样的资源可以让try语句自动关闭](/ReadingNotes/655287c5/#什么样的资源可以让try语句自动关闭)
    - [Closeable和AutoCloseable的区别](/ReadingNotes/655287c5/#Closeable和AutoCloseable的区别)
    - [Java 7几乎所有的资源类都可以自动关闭](/ReadingNotes/655287c5/#Java-7几乎所有的资源类都可以自动关闭)

<!--more-->
<script src="https://cdn.bootcss.com/jquery/3.4.0/jquery.slim.min.js"></script>
<script>$(document).ready(function () {$(".post-body > ul:nth-child(1)").hide();});</script>

<!--end-->
# 10.2.7 Java 7的自动关闭资源的try语句 #
`Java 7`增强了`try`语句的功能:它允许在`try`关键字后紧跟一对`圆括号`,圆括号可以声明、初始化一个或多个资源。此处的资源指的是那些必须在程序结束时显式关闭的资源(比如`数据库连接`、`网络连接`等),**`try`语句在该语句结束时`自动关闭`这些资源**。
## 什么样的资源可以让try语句自动关闭 ##
为了保证`try`语句可以正常关闭资源,这些资源实现类必须实现`AutoCloseable`或`Closeable`接口,实现这两个接口就必须实现`close()`方法。
## Closeable和AutoCloseable的区别 ##
`Closeable`是`AutoCloseable`的子接口,可以被自动关闭的资源类要么实现`AutoCloseable`接口,要么实现`Closeable`接口。 
- `Closeable`接口里的`close()`方法声明抛出了`IOException`,因此它的实现类在实现`close()`方法时**只能声明抛出`IOException`或其子类**;
- `AutoCloseable`接口里的`close()`方法声明抛出了`Exception`,因此它的实现类在实现`close()`方法时**可以声明拋出任何异常**。

下面程序示范了如何使用自动关闭资源的`try`语句。
```java
import java.io.*;

public class AutoCloseTest
{
    public static void main(String[] args)
        throws IOException
    {
        try (
            // 声明、初始化两个可关闭的资源
            // try语句会自动关闭这两个资源。
            BufferedReader br = new BufferedReader(
                new FileReader("AutoCloseTest.java"));
            PrintStream ps = new PrintStream(new
                FileOutputStream("a.txt"));
            )
        {
            // 使用两个资源
            System.out.println(br.readLine());
            ps.println("庄生晓梦迷蝴蝶");
        }
    }
}
```
上面程序中`try`后面圆括号中的代码分别声明、初始化了两个IO流,由于`BufferedReader`、 `PrintStream`都实现了`Closeable`接口,而且它们放在`try`语句中声明、初始化,所以`try`语句会自动关闭它们。因此上面程序是安全的。

**自动关闭资源的`try`语句相当于包含了隐式的`finally`块**(这个`finally`块用于关闭资源),因此这个**`try`语句可以既没有`catch`块,也没有`finally`块**。
## Java 7几乎所有的资源类都可以自动关闭 ##
`Java 7`几乎把所有的"资源类"(包括文件IO的各种类、`JDBC`编程的`Connection`、`Statement`等接口)进行了改写,改写后资源类都实现了`AutoCloseable`或`Closeable`接口。

如果程序需要,自动关闭资源的`try`语句后也可以带多个`catch`块和一个`finally`块。

