---
title: 16.4.2 后台线程
categories: 
  - 疯狂Java讲义 (第4版)
  - 第16章 多线程
  - 16.4 控制线程
date: 2019-07-17 12:30:32
updated: 2019-11-02 01:39:01
abbrlink: 1c771dc8
---
- [16.4.2 后台线程](/ReadingNotes/1c771dc8/#16-4-2-后台线程)
    - [什么是后台线程](/ReadingNotes/1c771dc8/#什么是后台线程)
    - [后台线程特征](/ReadingNotes/1c771dc8/#后台线程特征)
    - [如何把一个线程设置成后台线程](/ReadingNotes/1c771dc8/#如何把一个线程设置成后台线程)
    - [程序示例](/ReadingNotes/1c771dc8/#程序示例)
    - [如何判断一个线程是否是后台线程](/ReadingNotes/1c771dc8/#如何判断一个线程是否是后台线程)
    - [前后台的默认情况](/ReadingNotes/1c771dc8/#前后台的默认情况)
    - [后台线程死亡需要一定之间](/ReadingNotes/1c771dc8/#后台线程死亡需要一定之间)
    - [要先设置为后台线程再启动线程](/ReadingNotes/1c771dc8/#要先设置为后台线程再启动线程)

<!--more-->
<script src="https://cdn.bootcss.com/jquery/3.4.0/jquery.slim.min.js"></script>
<script>$(document).ready(function () {$(".post-body > ul:nth-child(1)").hide();});</script>

<!--end-->
<!--SSTStart-->
# 16.4.2 后台线程 #
## 什么是后台线程 ##
后台线程(`Daemon Thread`),是在后台运行的一种线程,后台线程主要用来**向其他的线程提供服务**。`JVM`的垃圾回收线程就是典型的后台线程。
## 后台线程特征 ##
后台线程有个特征:**如果所有的前台线程都死亡,后台线程会自动死亡**。
## 如何把一个线程设置成后台线程 ##
调用`Thread`对象的`setDaemon(true)`方法可将指定线程设置成后台线程。
<!--SSTStop-->
## 程序示例 ##
```java
public class DaemonThread extends Thread
{
	// 定义后台线程的线程执行体与普通线程没有任何区别
	public void run()
	{
		for (int i = 0; i < 1000 ; i++ )
		{
			System.out.println(getName() + "  " + i);
		}
        System.out.println("后台线程结束");
	}
	public static void main(String[] args)
	{
		DaemonThread t = new DaemonThread();
		// 将此线程设置成后台线程
		t.setDaemon(true);
		// 启动后台线程
		t.start();
		for (int i = 0 ; i < 10 ; i++ )
		{
			System.out.println(Thread.currentThread().getName()
				+ "  " + i);
		}
		// -----程序执行到此处，前台线程（main线程）结束------
		// 后台线程也应该随之结束
        System.out.println("前台(main)线程结束");
	}
}
```
下面程序将执行线程设置成后台线程,可以看到:
<!--SSTStart-->
当所有的前台线程死亡时,后台线程随之死亡。当整个虚拟机中只剩下后台线程时,程序就没有继续运行的必要了,所以虚拟机也就退出了。
<!--SSTStop-->
```cmd
main  0
main  1
......
main  7
main  8
Thread-0  0
main  9
前台(main)线程结束
Thread-0  1
Thread-0  2
......
Thread-0  16
Thread-0  17
```
上面程序中先将`t`线程设置成后台线程,然后启动该线程,本来该线程应该执行到循环变量`i`等于`999`时才会结束,
但运行该程序时不难发现该后台线程无法运行到循环变量`i`等于`999`时,因为程序中唯一的前台线程(`main`线程)运行结束后,`JVM`会主动退出,因而后台线程也就被结束了。
<!--SSTStart-->
## 如何判断一个线程是否是后台线程 ##
`Thread`类还提供了一个`isDaemon()`方法,用于判断指定线程是否为后台线程。
<!--SSTStop-->
从上面程序可以看出:
<!--SSTStart-->
## 前后台的默认情况 ##
- 主线程默认是前台线程,
- 前台线程创建的子线程默认是前台线程,
- 后台线程创建的子线程默认是后台线程。

## 后台线程死亡需要一定之间 ##
当所有的前台线程死亡后,`JVM`会给后台线程发出死亡通知,但后台线程从接收死亡通知到真正死亡,需要一定时间。
## 要先设置为后台线程再启动线程 ##
要将某个线程设置为后台线程,必须在该线程启动之前设置,也就是说,`setDaemon(true)`必须在`star()`方法之前调用,否则会引发`IllegalThreadStateException`异常。
<!--SSTStop-->

